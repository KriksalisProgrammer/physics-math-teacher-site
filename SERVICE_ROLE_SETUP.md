# ðŸš¨ Ð’ÐÐ–ÐÐž: Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Service Role Key

Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÐµÐ¹ Ð½ÑƒÐ¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Service Role Key Ð² Ñ„Ð°Ð¹Ð» `.env.local`:

## 1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Service Role Key

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Supabase Dashboard: https://supabase.com/dashboard
2. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð¿Ñ€Ð¾ÐµÐºÑ‚
3. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Settings â†’ API
4. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» "Project API keys"
5. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ **service_role** (ÐÐ• anon!)

## 2. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² .env.local

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env.local` Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ:

```env
SUPABASE_SERVICE_ROLE_KEY=Ð²Ð°Ñˆ_service_role_key_Ð·Ð´ÐµÑÑŒ
```

## 3. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²ÐµÑ€

```bash
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²ÐµÑ€ (Ctrl+C)
# Ð—Ð°Ñ‚ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð·Ð°Ð½Ð¾Ð²Ð¾:
npm run dev
```

## 4. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: http://localhost:3000/create-profiles.html

## âš ï¸ Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬

Service Role Key Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°!
- ÐÐ• ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚ÑŒÑ‚Ðµ ÐµÐ³Ð¾ Ð² Git
- ÐÐ• Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ð¸Ð¼ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
- Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

## ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð±ÐµÐ· Service Role Key

Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Service Role Key, Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ SQL Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² Supabase:

```sql
-- Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð±ÐµÐ· Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÐµÐ¹
INSERT INTO profiles (id, email, role, first_name, last_name, age)
SELECT 
    au.id,
    au.email,
    'student' as role,
    COALESCE(au.raw_user_meta_data->>'first_name', au.user_metadata->>'first_name', '') as first_name,
    COALESCE(au.raw_user_meta_data->>'last_name', au.user_metadata->>'last_name', '') as last_name,
    CASE 
        WHEN au.raw_user_meta_data->>'age' IS NOT NULL AND au.raw_user_meta_data->>'age' != ''
        THEN (au.raw_user_meta_data->>'age')::integer 
        WHEN au.user_metadata->>'age' IS NOT NULL AND au.user_metadata->>'age' != ''
        THEN (au.user_metadata->>'age')::integer
        ELSE NULL 
    END as age
FROM auth.users au
LEFT JOIN profiles p ON au.id = p.id
WHERE p.id IS NULL;
```
